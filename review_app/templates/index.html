{% extends "base.html" %}

{% block content %}
<h2 style="margin-bottom: 20px;">Overview</h2>
<div class="stats">
    <div class="stat-card">
        <div class="stat-value">{{ stats['total_groups']|number_format }}</div>
        <div class="stat-label">Total Duplicate Groups</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ stats['total_photos']|number_format }}</div>
        <div class="stat-label">Total Photos in Groups</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ stats['suggested_keeps']|number_format }}</div>
        <div class="stat-label">Photos to Keep</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ (stats['total_photos'] - stats['suggested_keeps'])|number_format }}</div>
        <div class="stat-label">Photos to Reject</div>
    </div>
</div>

<h2 style="margin-top: 40px; margin-bottom: 20px;">Auto-Resolution Results</h2>
<div class="stats">
    <div class="stat-card" style="background: #e8f5e9;">
        <div class="stat-value" style="color: #2e7d32;">{{ auto_stats['auto_resolved_groups']|number_format }}</div>
        <div class="stat-label">Auto-Resolved Groups</div>
    </div>
    <div class="stat-card" style="background: #fff3e0;">
        <div class="stat-value" style="color: #e65100;">{{ manual_stats['manual_groups']|number_format }}</div>
        <div class="stat-label">Require Manual Review</div>
    </div>
    <div class="stat-card" style="background: #e8f5e9;">
        <div class="stat-value" style="color: #2e7d32;">{{ auto_stats['auto_rejects']|number_format }}</div>
        <div class="stat-label">Derivatives Auto-Rejected</div>
    </div>
    <div class="stat-card" style="background: #f3e5f5;">
        <div class="stat-value" style="color: #6a1b9a;">{{ ((auto_stats['auto_resolved_groups'] * 100.0 / stats['total_groups'])|round(1)) }}%</div>
        <div class="stat-label">Groups Auto-Resolved</div>
    </div>
</div>

<div style="margin: 30px 0;">
    <a href="/groups" class="btn">Review Remaining {{ manual_stats['manual_groups']|number_format }} Groups</a>
</div>

<h2 style="margin-top: 40px; margin-bottom: 20px;">Group Size Distribution</h2>
<div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="border-bottom: 2px solid #ddd;">
                <th style="padding: 10px; text-align: left;">Photos per Group</th>
                <th style="padding: 10px; text-align: right;">Number of Groups</th>
                <th style="padding: 10px; text-align: right;">Total Photos</th>
            </tr>
        </thead>
        <tbody>
            {% for row in size_dist %}
            <tr style="border-bottom: 1px solid #eee;">
                <td style="padding: 10px;">{{ row['group_size'] }} photos</td>
                <td style="padding: 10px; text-align: right;">{{ row['count']|number_format }}</td>
                <td style="padding: 10px; text-align: right;">{{ (row['group_size'] * row['count'])|number_format }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Custom number formatting filter
document.querySelectorAll('[data-number]').forEach(el => {
    el.textContent = parseInt(el.getAttribute('data-number')).toLocaleString();
});
</script>
{% endblock %}
