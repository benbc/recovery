#!/usr/bin/env python3
"""
Simple SQL query executor for photos database
Usage: ./query "SELECT ..."
"""

import sqlite3
import sys
from pathlib import Path

DB_PATH = Path("organized/photos.db")

if len(sys.argv) < 2:
    print("Usage: ./query 'SELECT ...'")
    sys.exit(1)

if not DB_PATH.exists():
    print(f"Error: Database not found at {DB_PATH}")
    sys.exit(1)

sql = sys.argv[1]

try:
    conn = sqlite3.connect(DB_PATH)
    cursor = conn.execute(sql)

    # Get column names
    cols = [desc[0] for desc in cursor.description] if cursor.description else []

    if cols:
        # Print header
        print("\t".join(cols))

        # Print rows
        for row in cursor:
            print("\t".join(str(x) if x is not None else "" for x in row))
    else:
        # Non-SELECT query
        conn.commit()
        print(f"Rows affected: {cursor.rowcount}")

    conn.close()
except Exception as e:
    print(f"Error: {e}", file=sys.stderr)
    sys.exit(1)
